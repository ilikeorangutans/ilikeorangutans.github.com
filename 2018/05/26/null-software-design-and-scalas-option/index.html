<!DOCTYPE html>
<html>
  <head>
        <meta charset="utf-8">
    <title>
      
        null, Software Design, and Scala&#39;s Option &mdash;
      
      Jakob Külzer
    </title>

    <meta name="author" value="Jakob Külzer">
    <meta property="og:title" content="null, Software Design, and Scala&#39;s Option">
    <meta property="og:description" content="For the past year or so I&rsquo;ve been writing a lot of Scala and fallen in love with its Option type and how it allows me to avoid nulls. I reflected on null, why they are bad, and how optional types allow you to write more expressive code.
What is null? Most programming languages have the concept of null (or nil) that represents the absence of a given value or object.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="https://ilikeorangutans.github.io/2018/05/26/null-software-design-and-scalas-option/">

    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="alternate" href="https://ilikeorangutans.github.io/index.xml" type="application/rss+xml" title="Jakob Külzer">

    <link rel="stylesheet" href="/css/spectre.min.css">
    <link rel="stylesheet" href="/css/style.css">

    <link rel="canonical" href="https://ilikeorangutans.github.io/">

  </head>
  <body>
    
    <div class="container grid-lg">
  <header class="navbar hide-sm">
    <section class="navbar-section">
      <a href="/" class="navbar-brand">
        Jakob Külzer
      </a>
    </section>
    <section class="navbar-section">
      
        <a href="/" class="mr-2 ml-2">
          Home
        </a>
      
        <a href="/posts/" class="mr-2 ml-2">
          Blog
        </a>
      
        <a href="/projects/" class="mr-2 ml-2">
          Projects
        </a>
      
        <a href="/about/" class="mr-2 ml-2">
          About
        </a>
      
    </section>
  </header>

  <header class="show-sm columns">
    <div class="column col-12">
      <a href="/" class="navbar-brand">
        Jakob Külzer
      </a>
    </div>
    <div class="column col-12">
      
        <a href="/" class="mr-2 ml-1">
          Home
        </a>
      
        <a href="/posts/" class="mr-2 ml-1">
          Blog
        </a>
      
        <a href="/projects/" class="mr-2 ml-1">
          Projects
        </a>
      
        <a href="/about/" class="mr-2 ml-1">
          About
        </a>
      
    </div>
  </header>
</div>
<div class="divider"></div>
    
    <main class="container grid-lg content">
      
    <div class="columns mb-2">
        <div class="column">
            <p class="text-gray">
                26 May 2018


, tagged:


    <a href="/tags/scala" class="">
        Scala, 
    </a>

    <a href="/tags/software-development" class="">
        Software Development, 
    </a>

    <a href="/tags/null" class="">
        null, 
    </a>

    <a href="/tags/typescript" class="">
        TypeScript, 
    </a>

    <a href="/tags/go" class="">
        Go, 
    </a>

    <a href="/tags/golang" class="">
        Golang
    </a>



            </p>
            <div class="divider"></div>
            
            <h1>null, Software Design, and Scala&#39;s Option</h1>
            <p>For the past year or so I&rsquo;ve been writing a lot of Scala and fallen in love with its <code>Option</code> type and how it allows me to avoid <code>null</code>s. I reflected on <code>null</code>, why they are bad, and how optional types allow you to write more expressive code.</p>
<h2 id="what-is-null">What is null?</h2>
<p>Most programming languages have the concept of <code>null</code> (or <code>nil</code>) that represents the absence of a given value or object. At it&rsquo;s surface the absence of a value probably just translates into a pointer of value <code>0x0</code> or in languages that do not zero variables, a pointer anywhere into the memory. But aside from the implementation details the more interesting question is how <code>null</code> fits into a language&rsquo;s type system.</p>
<p>In pretty much every language you can define a variable or parameter of a given type and subsequently you can only assign values of compatible types. That means the same type or in some languages a sub-type. For example, in Scala:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#069;font-weight:bold">var</span> name<span style="color:#069;font-weight:bold">:</span> <span style="color:#078;font-weight:bold">String</span> <span style="color:#555">=</span> <span style="color:#c30">&#34;Jakob&#34;</span>
<span style="color:#069;font-weight:bold">var</span> number<span style="color:#069;font-weight:bold">:</span> <span style="color:#078;font-weight:bold">Int</span> <span style="color:#555">=</span> <span style="color:#f60">32</span>

<span style="color:#09f;font-style:italic">// Obviously this will fail:
</span><span style="color:#09f;font-style:italic"></span>name <span style="color:#069;font-weight:bold">=</span> number
</code></pre></div><p>Nothing surprising. In statically typed languages this is an illegal move. The compiler will disapprove of your choice.</p>
<p>But then, surprisingly, <code>null</code> can be assigned to everything:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#069;font-weight:bold">var</span> name<span style="color:#069;font-weight:bold">:</span> <span style="color:#078;font-weight:bold">String</span> <span style="color:#555">=</span> <span style="color:#c30">&#34;Jakob&#34;</span>
<span style="color:#069;font-weight:bold">var</span> number<span style="color:#069;font-weight:bold">:</span> <span style="color:#078;font-weight:bold">Int</span> <span style="color:#555">=</span> <span style="color:#f60">32</span>

<span style="color:#09f;font-style:italic">// This works:
</span><span style="color:#09f;font-style:italic"></span>name <span style="color:#069;font-weight:bold">=</span> <span style="color:#069;font-weight:bold">null</span>
<span style="color:#09f;font-style:italic">// This also works:
</span><span style="color:#09f;font-style:italic"></span>number <span style="color:#069;font-weight:bold">=</span> <span style="color:#069;font-weight:bold">null</span>
</code></pre></div><p>The realization that <code>null</code> is essentially a type wildcard might be trivial to some but was a bit of an epiphany to me. It&rsquo;s kind of elegant and helps developers deal with situations where they simply don&rsquo;t know what a value is. In languages where blocks are not expressions it makes writing conditional initialization of values possible without having to write helper methods.</p>
<h2 id="null-troubles">null Troubles</h2>
<p>The issue with <code>null</code> being a chameleon in the type system is problematic, not so much because it can cause the infamous <code>NullPointerException</code> in Java, but more so because it&rsquo;s essentially an incompatible type that&rsquo;s magically turned into a <em>duck</em>. You know, <em>if it quacks like a duck and walks like a duck&hellip;</em> Except, in the case of null, you don&rsquo;t get a duck, you get nothing. In most languages when you get a variable or parameter of a type <code>T</code> with a method <code>m</code> you know that you can invoke <code>m</code> on it, even if your variable is actually a sub-type of <code>T</code>. That makes reasoning about the code easy. You&rsquo;d never expect that your parameter or return value wouldn&rsquo;t let you call a method that is defined on its type unless&hellip; it&rsquo;s <code>null</code>.</p>
<p>This is the core of the issue with <code>null</code>. It acts like something it <em>is not</em> under the disguise of a different type. It&rsquo;s like biting into a doughnut that&rsquo;s filled with mustard instead of strawberry jam. And to continue that analogy &ndash; both because I like baked goods and because the thought of getting a mouthful of mustard when expecting something sweet perfectly captures the feeling when your app fails with a null pointer &ndash; writing code that can return <code>null</code> or uses <code>null</code> is like buying a dozen doughnuts where some <em>might</em> be filled with mustard. Most of the time you&rsquo;re fine, but when you get one with mustard, you&rsquo;re going to have a bad day.</p>
<p>One notable exception that I know of is <code>Go</code> in which methods are selected based on the receiver type of a method, not it&rsquo;s value. You&rsquo;ll have to account for a <code>nil</code> receiver in your method:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#069;font-weight:bold">type</span> Foo <span style="color:#069;font-weight:bold">struct</span> {}
<span style="color:#c0f">def</span> (f <span style="color:#555">*</span>Foo) <span style="color:#c0f">doSomething</span>() <span style="color:#078;font-weight:bold">string</span> {
  <span style="color:#069;font-weight:bold">if</span> f <span style="color:#555">==</span> <span style="color:#069;font-weight:bold">nil</span> {
    <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#34;called on a nil receiver&#34;</span>
  } <span style="color:#069;font-weight:bold">else</span> {
    <span style="color:#069;font-weight:bold">return</span> <span style="color:#c30">&#34;called with a non-nil receiver&#34;</span>
  }
}

<span style="color:#069;font-weight:bold">var</span> foo Foo = <span style="color:#069;font-weight:bold">nil</span>
foo.<span style="color:#c0f">doSomething</span>() <span style="color:#09f;font-style:italic">// =&gt; &#34;called on a nil receiver&#34;
</span></code></pre></div><p>This makes it easy to write code in Go that&rsquo;s <code>nil</code> resilient, but at the end of the day this does not solve the underlying problem. Writing all your methods like this is cumbersome and does not communicate well that something can or cannot be <code>nil</code>. And if you forget to implement your methods in this way, the compiler won&rsquo;t warn you, so essentially you&rsquo;re back to square <code>null</code>.</p>
<p>Fundamentally <code>null</code> is problematic because it conflates two things into a single type: the actual object from your problem domain and the idea that it might or might not be there. And sadly, the type system in most languages does not let you specify whether a type can be <code>null</code> or not. The only exception that I know of is TypeScript and typescript handles it beautifully. If <a href="https://www.typescriptlang.org/docs/handbook/release-notes/typescript-2-0.html"><code>strictNullChecks</code></a> are enabled, the TypeScript compiler won&rsquo;t allow <code>null</code> to be assigned unless the target type is a union type of <code>null</code> and the actual type:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-typescript" data-lang="typescript"><span style="color:#069;font-weight:bold">let</span> x: <span style="color:#078;font-weight:bold">number</span>;
x <span style="color:#555">=</span> <span style="color:#f60">1</span>; <span style="color:#09f;font-style:italic">// this works
</span><span style="color:#09f;font-style:italic"></span>x <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">null</span>; <span style="color:#09f;font-style:italic">// not allowed
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">let</span> name: <span style="color:#078;font-weight:bold">number</span> <span style="color:#555">|</span> <span style="color:#069;font-weight:bold">null</span>; <span style="color:#09f;font-style:italic">// name is either a number or a null
</span><span style="color:#09f;font-style:italic"></span>name <span style="color:#555">=</span> <span style="color:#069;font-weight:bold">null</span>; <span style="color:#09f;font-style:italic">// This is now valid!
</span><span style="color:#09f;font-style:italic"></span>name <span style="color:#555">=</span> <span style="color:#c30">&#34;Jakob&#34;</span>;
</code></pre></div><p>I really love this concept and mentally replace any variable/parameter&rsquo;s type definition with this. Instead of <code>x: String</code> I now think <code>x: String | null</code> because it represents the reality more truthfully.</p>
<h2 id="scalas-optiont">Scala&rsquo;s Option[T]</h2>
<p>In Scala one can use the <a href="https://www.scala-lang.org/api/current/scala/Option.html"><code>Option[T]</code></a> type to represent something that might be there or not. It&rsquo;s implemented as a sealed abstract class with exactly two possible implementations: <code>None</code> or <code>Some[T]</code>. If you need to represent an optional value, you define it as <code>Option[String]</code> and you&rsquo;ll get either a <code>None</code> or <code>Some</code>:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#069;font-weight:bold">val</span> name<span style="color:#069;font-weight:bold">:</span> <span style="color:#078;font-weight:bold">Option</span><span style="color:#555">[</span><span style="color:#078;font-weight:bold">String</span><span style="color:#555">]</span> <span style="color:#069;font-weight:bold">=</span> getName<span style="color:#555">()</span>
name <span style="color:#069;font-weight:bold">match</span> <span style="color:#555">{</span>
  <span style="color:#069;font-weight:bold">case</span> <span style="color:#0a8;font-weight:bold">Some</span><span style="color:#555">(</span>actualName<span style="color:#555">)</span> <span style="color:#069;font-weight:bold">=&gt;</span> println <span style="color:#c30">s&#34;Hello, </span><span style="color:#a00">$name</span><span style="color:#c30">&#34;</span>
  <span style="color:#069;font-weight:bold">case</span> <span style="color:#0a8;font-weight:bold">None</span> <span style="color:#069;font-weight:bold">=&gt;</span> println <span style="color:#c30">&#34;Who goes there?&#34;</span>
<span style="color:#555">}</span>
</code></pre></div><p>Nothing fancy here, and one might argue that this is not really better than simply checking if a value is null or not:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#069;font-weight:bold">val</span> name<span style="color:#069;font-weight:bold">:</span> <span style="color:#078;font-weight:bold">String</span> <span style="color:#555">=</span> getName<span style="color:#555">()</span>
<span style="color:#069;font-weight:bold">if</span> name <span style="color:#555">==</span> <span style="color:#069;font-weight:bold">null</span> <span style="color:#555">{</span>  println <span style="color:#c30">s&#34;Hello, </span><span style="color:#a00">$name</span><span style="color:#c30">&#34;</span> <span style="color:#555">}</span> <span style="color:#069;font-weight:bold">else</span> <span style="color:#555">{</span> println <span style="color:#c30">&#34;Who goes there?&#34;</span> <span style="color:#555">}</span>
</code></pre></div><p>But as any abstraction can be broken down into smaller parts, so can Option. And if we consider only the parts it&rsquo;s made of, there&rsquo;s clearly nothing gained. But, that&rsquo;s the thing about abstractions, they make more sense if we raise our viewpoint.</p>
<p>Having a method return an <code>Option</code> or a value type as such, doesn&rsquo;t change how the code has to be handled, but makes it explicit that it <em>should</em> be handled differently, both to the compiler and to the developer. If I receive an <code>Option</code> from a method or as a parameter, I know that I should check if I have nothing or something. But if I am OK with an exception, I can call <code>.get</code> on the <code>Option</code> without actually checking. With a non-Option it&rsquo;s like with the doughnuts. The more experience you have, the more defensive you program and the more you check for nulls, just like you&rsquo;d check your doughnuts for signs of mustard. But that&rsquo;s just not a good way of eating&hellip;</p>
<h2 id="closing-thoughts">Closing Thoughts</h2>
<p>I realize other languages have constructs like this as well, for example in Java 8 we now have the <a href="https://docs.oracle.com/javase/8/docs/api/java/util/Optional.html"><code>Optional&lt;T&gt;</code></a> type that fulfills pretty much the same role, but only recently did I really understand the value of an optional type like this. Having seen what TypeScript&rsquo;s Union types do really opened my eyes, and now I wish all languages had this concept.</p>
<p>But what languages lack we have to make up for with discipline and care for the craft. So, don&rsquo;t do this:</p>
<div class="highlight"><pre style="background-color:#f0f3f3;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-scala" data-lang="scala"><span style="color:#09f;font-style:italic">// Someone is going to have a bad day...
</span><span style="color:#09f;font-style:italic"></span><span style="color:#069;font-weight:bold">val</span> <span style="color:#0a8;font-weight:bold">Option</span><span style="color:#555">[</span><span style="color:#078;font-weight:bold">Day</span><span style="color:#555">]</span> <span style="color:#069;font-weight:bold">=</span> <span style="color:#069;font-weight:bold">null</span>
</code></pre></div>
            <div class="divider"></div>
        </div>
    </div>
    <div id="disqus_thread"></div>
<script type="application/javascript">
    var disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ilikeorangutans" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </main>
    
    <div class="divider"></div>
<div class="container grid-lg mb-2">
    <footer class="navbar text-gray">
        <section class="navbar-section">
            &copy; 2018 Jakob Külzer
        </section>
        <section class="navbar-center">
            <a href="mailto:jakob.kuelzer@gmail.com" class="btn btn-link">Email</a> |
            <a href="https://github.com/ilikeorangutans" target="_blank" class="btn btn-link">Github</a> |
            <a href="https://www.linkedin.com/in/jakobkuelzer/" target="_blank" class="btn btn-link">LinkedIn</a> |
            <a href="/index.xml" class="btn btn-link">RSS</a>
        </section>
        <section class="navbar-section"></section>
    </footer>
</div>

    
  </body>
</html>