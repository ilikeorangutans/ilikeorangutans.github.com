<!DOCTYPE html>
<html>
  <head><script src="/livereload.js?mindelay=10&amp;v=2&amp;port=1313&amp;path=livereload" data-no-instant defer></script>
        <meta charset="utf-8">
    <title>
      
        First Steps in Zig - Linking against cimgui &mdash;
      
      Jakob Külzer
    </title>

    <meta name="author" value="Jakob Külzer">
    <meta property="og:title" content="First Steps in Zig - Linking against cimgui">
    <meta property="og:description" content="I&rsquo;ve been doing some small zig programs to learn the various aspects of the language and its tooling and I figured it might be a good topic to document here.
For my first foray into linking against C libraries I&rsquo;ve picked cimgui, mostly because I&rsquo;ve always wanted to write
something with it. And zig claims to have good C interop, so might as well try that.
This post is a step-by-step documentation of me trying to get this to work, so keep in mind that I haven&rsquo;t really written any C since university and this is
going to be a bumpy ride.">
    <meta property="og:type" content="article">
    <meta property="og:url" content="http://localhost:1313/2023/10/29/first-steps-in-zig-linking-against-cimgui/">

    <meta name="viewport" content="width=device-width, initial-scale=1">

    

    <link rel="stylesheet" href="/css/output.css">

    <link rel="canonical" href="http://localhost:1313/">

  </head>
  <body class="bg-gray-50 text-gray-900">
    
    <header class="bg-white shadow-sm border-b">
    <div class="max-w-4xl mx-auto px-4 py-6">
        <nav class="flex justify-between items-center">
            <a href="/" class="navbar-brand">
                <h1 class="text-2xl font-bold text-teal-900 hover:text-orange-400 transition-colors">Jakob Külzer</h1>
            </a>
            <div class="space-x-6">
                
                <a href="/" class="text-gray-600 hover:text-orange-400 transition-colors">Home</a>
                
                <a href="/posts/" class="text-gray-600 hover:text-orange-400 transition-colors">Blog</a>
                
                <a href="/projects/" class="text-gray-600 hover:text-orange-400 transition-colors">Projects</a>
                
                <a href="/about/" class="text-gray-600 hover:text-orange-400 transition-colors">About</a>
                
            </div>
        </nav>
    </div>
</header>

    
    <main class="max-w-4xl mx-auto px-4 py-8">
      
<article class="bg-white rounded-lg shadow-sm overflow-hidden">
    
    

    
    <div class="p-6">
        <div class="text-sm text-gray-500 ">
            <time datetime="2023-10-29">
                29 Oct 2023
            </time>
            
        </div>
        
        <h1 class="text-3xl md:text-4xl font-bold text-gray-900 mb-4 leading-tight">
             [DRAFT] 
            First Steps in Zig - Linking against cimgui
        </h1>

        <div class="flex items-center justify-between mb-8 pb-6 border-b border-gray-200">
            <div class="flex flex-wrap gap-2 mb-4">
                 
                <a href="/tags/zig" class="bg-gray-100 hover:bg-teal-100 text-gray-700 hover:text-teal-800 px-3 py-1 rounded-full text-sm font-medium transition-colors duration-200 cursor-pointer">
                    zig
                </a>
                
            </div>
        </div>

        <div class="prose prose-lg max-w-none">
            <p>I&rsquo;ve been doing some small zig programs to learn the various aspects of the language and its tooling and I figured it might be a good topic to document here.</p>
<p>For my first foray into linking against C libraries I&rsquo;ve picked <a href="https://github.com/cimgui/cimgui">cimgui</a>, mostly because I&rsquo;ve always wanted to write
something with it. And zig claims to have good C interop, so might as well try that.</p>
<p>This post is a step-by-step documentation of me trying to get this to work, so keep in mind that I haven&rsquo;t really written any C since university and this is
going to be a bumpy ride.</p>
<p>Let&rsquo;s begin by setting up a project:</p>
<pre tabindex="0"><code>mkdir zig-demo-cimgui &amp;&amp; cd zig-demo-cimgui &amp;&amp; zig init-exe
</code></pre><p>Now the first challenge is that I need the header file for cimgui. It claims to be a single header so I downloaded it and placed it in my <code>src</code> directory:</p>
<pre tabindex="0"><code>curl -L https://github.com/cimgui/cimgui/raw/docking_inter/cimgui.h -o src/cimgui.h
</code></pre><p>The one thing I remember from C is that you need to include the header files via preprocessor rules and then tell the linker which libraries you want to add.
Zig offers the <a href="https://ziglang.org/documentation/0.11.0/#cImport"><code>@cImport()</code> builtin</a> to parse C and load the available functions and fields into a struct.</p>
<div class="highlight"><pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zig" data-lang="zig"><span style="display:flex;"><span><span style="color:#5918bb;font-weight:bold">@cImport</span>();<span style="color:#cbcbcb">
</span></span></span></code></pre></div><p>The error messages are a little confusing when you&rsquo;re trying to figure out the syntax:</p>
<p><img src="01.png" alt=""></p>
<p>After reading the docs again I realized <code>@cImport</code> takes a list of expressions like <code>@cInclude</code> or <code>@cDefine</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zig" data-lang="zig"><span style="display:flex;"><span><span style="color:#5918bb;font-weight:bold">@cImport</span>({<span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb">    </span><span style="color:#5918bb;font-weight:bold">@cInclude</span>(<span style="color:#0c6">&#34;cimgui.h&#34;</span>);<span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb"></span>});<span style="color:#cbcbcb">
</span></span></span></code></pre></div><p>I&rsquo;m still getting the very unhelpful error message <code>main.zig:5:3: error: expected ',' after field</code> and I finally realized that I have to assign the return value
of <code>@cImport</code> to a const:</p>
<div class="highlight"><pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zig" data-lang="zig"><span style="display:flex;"><span><span style="color:#2c5dcd;font-weight:bold">const</span><span style="color:#cbcbcb"> </span>c<span style="color:#cbcbcb"> </span><span style="color:#2c5dcd">=</span><span style="color:#cbcbcb"> </span><span style="color:#5918bb;font-weight:bold">@cImport</span>({<span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb">    </span><span style="color:#5918bb;font-weight:bold">@cInclude</span>(<span style="color:#0c6">&#34;cimgui.h&#34;</span>);<span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb"></span>});<span style="color:#cbcbcb">
</span></span></span></code></pre></div><p>This finally compiles again so let&rsquo;s try to use the imported library:</p>
<div class="highlight"><pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zig" data-lang="zig"><span style="display:flex;"><span><span style="color:#2c5dcd;font-weight:bold">pub</span><span style="color:#cbcbcb"> </span><span style="color:#2c5dcd;font-weight:bold">fn</span><span style="color:#cbcbcb"> </span><span style="color:#ff8000;font-weight:bold">main</span>()<span style="color:#cbcbcb"> </span><span style="color:#2c5dcd">!</span><span style="color:#5918bb;font-weight:bold">void</span><span style="color:#cbcbcb"> </span>{<span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb">    </span>_<span style="color:#cbcbcb"> </span><span style="color:#2c5dcd">=</span><span style="color:#cbcbcb"> </span>c.<span style="color:#ff8000;font-weight:bold">igCreateContext</span>(<span style="color:#2c5dcd;font-weight:bold">null</span>);<span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb"></span>}<span style="color:#cbcbcb">
</span></span></span></code></pre></div><p>The compiler did <em>not</em> like that:</p>
<pre tabindex="0"><code>main.zig:3:11: error: C import failed
const c = @cImport({
          ^~~~~~~~
main.zig:3:11: note: libc headers not available; compilation does not link against libc
~/zig-demo-cimgui/zig-cache/o/4f81bba7ec85f00b9a39519067b4c3be/cimport.h:1:10: error: &#39;cimgui.h&#39; file not found
#
</code></pre><p>Aha, so how does one link libc and how does one specify a search path for finding includes? The docs don&rsquo;t specifically say so but after some poking around
I realize it&rsquo;s all done in <code>build.zig</code> with <a href="https://ziglang.org/documentation/master/std/#A;std:Build.LibExeObjStep.linkLibC"><code>linkLibC()</code></a> and
<a href="https://ziglang.org/documentation/master/std/#A;std:Build.LibExeObjStep.addIncludePath"><code>addIncludePath</code></a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zig" data-lang="zig"><span style="display:flex;"><span><span style="color:#cbcbcb">    </span><span style="color:#2c5dcd;font-weight:bold">const</span><span style="color:#cbcbcb"> </span>exe<span style="color:#cbcbcb"> </span><span style="color:#2c5dcd">=</span><span style="color:#cbcbcb"> </span>b.<span style="color:#ff8000;font-weight:bold">addExecutable</span>(.{<span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb">        </span><span style="color:#0080ff;font-style:italic">// ...
</span></span></span><span style="display:flex;"><span><span style="color:#0080ff;font-style:italic"></span><span style="color:#cbcbcb">    </span>});<span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb">    </span>exe.<span style="color:#ff8000;font-weight:bold">linkLibC</span>();<span style="color:#cbcbcb"> </span><span style="color:#0080ff;font-style:italic">// Easy as this
</span></span></span><span style="display:flex;"><span><span style="color:#0080ff;font-style:italic"></span><span style="color:#cbcbcb">    </span>exe.<span style="color:#ff8000;font-weight:bold">addIncludePath</span>();<span style="color:#cbcbcb">
</span></span></span></code></pre></div><p><a href="https://ziglang.org/documentation/master/std/#A;std:Build.LibExeObjStep.addIncludePath"><code>addIncludePath</code></a> took a little bit to figure out. The parameter is of type
<a href="https://ziglang.org/documentation/master/std/#A;std:Build.FileSource"><code>LazyPath</code></a> but weirdly enough that references a union name <code>FileSource</code>. Digging a little
reveals that this is a <a href="https://ziglang.org/documentation/master/std/src/std/Build.zig.html#L60">deprecated type and things are in motion</a>.</p>
<p>Ok, <code>LazyPath</code> has several members, we probably want <code>.path</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zig" data-lang="zig"><span style="display:flex;"><span><span style="color:#cbcbcb">    </span>exe.<span style="color:#ff8000;font-weight:bold">addIncludePath</span>(.{<span style="color:#cbcbcb"> </span>.path<span style="color:#cbcbcb"> </span><span style="color:#2c5dcd">=</span><span style="color:#cbcbcb"> </span><span style="color:#0c6">&#34;src&#34;</span><span style="color:#cbcbcb"> </span>});<span style="color:#cbcbcb">
</span></span></span></code></pre></div><p>The literal syntax for structs still feels a bit strange but I&rsquo;m getting the hang of it. And the good news is the above works, zig finds the header file.
The bad news is the compiler is still not happy:</p>
<pre tabindex="0"><code>error: too many errors emitted, stopping now
</code></pre><p>Ok, so I remember faintly that cimgui needs a preprocessor define to build all the types. So let&rsquo;s try that, back in main.zig:</p>
<div class="highlight"><pre tabindex="0" style="color:#4d4d4d;background-color:#fff;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-zig" data-lang="zig"><span style="display:flex;"><span><span style="color:#2c5dcd;font-weight:bold">const</span><span style="color:#cbcbcb"> </span>c<span style="color:#cbcbcb"> </span><span style="color:#2c5dcd">=</span><span style="color:#cbcbcb"> </span><span style="color:#5918bb;font-weight:bold">@cImport</span>({<span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb">    </span><span style="color:#5918bb;font-weight:bold">@cDefine</span>(<span style="color:#0c6">&#34;CIMGUI_DEFINE_ENUMS_AND_STRUCTS&#34;</span>,<span style="color:#cbcbcb"> </span>{});<span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb">    </span><span style="color:#5918bb;font-weight:bold">@cInclude</span>(<span style="color:#0c6">&#34;cimgui.h&#34;</span>);<span style="color:#cbcbcb">
</span></span></span><span style="display:flex;"><span><span style="color:#cbcbcb"></span>});<span style="color:#cbcbcb">
</span></span></span></code></pre></div><p>After the preprocessor and the compiler we&rsquo;re now at the linker and it&rsquo;s also not happy:</p>
<pre tabindex="0"><code>error: ld.lld: undefined symbol: igCreateContext
    note: referenced by main.zig:9
    note:               ~/zig-demo-cimgui/zig-cache/o/3660e2ee475da70945e7e9e13e998206/zig-demo-cimgui.o:(main.main)
</code></pre>
        </div>
    </div>
</article>
    <div id="disqus_thread"></div>
<script>
    window.disqus_config = function () {
    
    
    
    };
    (function() {
        if (["localhost", "127.0.0.1"].indexOf(window.location.hostname) != -1) {
            document.getElementById('disqus_thread').innerHTML = 'Disqus comments not available by default when the website is previewed locally.';
            return;
        }
        var d = document, s = d.createElement('script'); s.async = true;
        s.src = '//' + "ilikeorangutans" + '.disqus.com/embed.js';
        s.setAttribute('data-timestamp', +new Date());
        (d.head || d.body).appendChild(s);
    })();
</script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>
<a href="https://disqus.com" class="dsq-brlink">comments powered by <span class="logo-disqus">Disqus</span></a>

    </main>
    
    <footer class="bg-white border-t mt-12">
    <div class="max-w-4xl mx-auto px-4 py-8">
        <div class="text-center text-gray-600">
            <p>&copy; 2025 Jakob Külzer. All rights reserved.</p>
            <div class="mt-4 space-x-6">
                <a href="mailto:jakob.kuelzer@gmail.com" class="hover:text-teal-600 transition-colors">Email</a>
                <a href="https://github.com/ilikeorangutans" target="_blank" class="hover:text-teal-600 transition-colors">Github</a> 
                <a href="https://sr.ht/~ilikeorangutans/" target="_blank" class="hover:text-teal-600 transition-colors">Sourcehut</a> 
                <a href="https://www.linkedin.com/in/jakobkuelzer/" target="_blank" class="hover:text-teal-600 transition-colors">LinkedIn</a> 
                
            </div>
        </div>
    </div>
</footer>

    
  </body>
</html>
